<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Brain AI - Cognitive Interface v2.2-DEBUG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --accent-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.12);
            --shadow-glow: 0 0 40px rgba(102, 126, 234, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background particles */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .particle:nth-child(1) { width: 80px; height: 80px; top: 20%; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 40px; height: 40px; top: 60%; left: 20%; animation-delay: 2s; }
        .particle:nth-child(3) { width: 60px; height: 60px; top: 40%; left: 70%; animation-delay: 4s; }
        .particle:nth-child(4) { width: 30px; height: 30px; top: 80%; left: 80%; animation-delay: 1s; }
        .particle:nth-child(5) { width: 50px; height: 50px; top: 30%; left: 50%; animation-delay: 3s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.3; }
            50% { transform: translateY(-20px) scale(1.1); opacity: 0.6; }
        }

        /* Liquid Glass Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header */
        .header {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow);
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #f0f0f0, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        /* Status Bar */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .status-card:hover::before {
            transform: scaleX(1);
        }

        .status-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .status-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .status-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* Control Panel */
        .control-panel {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .glass-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 15px 20px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .glass-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }

        .glass-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-hint {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 10px 15px;
            margin-top: 8px;
            color: rgba(102, 126, 234, 1);
            font-size: 0.85rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-button {
            background: var(--secondary-gradient);
            border: none;
            border-radius: 16px;
            padding: 15px 30px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-top: 10px;
        }

        .glass-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .glass-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(75, 172, 254, 0.4);
        }

        .glass-button:hover::before {
            left: 100%;
        }

        .glass-button:active {
            transform: translateY(-1px);
        }

        /* Response Area */
        .response-area {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
            min-height: 400px;
        }

        .response-content {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 20px;
            color: var(--text-primary);
            font-family: 'Inter', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 500px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Chat Interface */
        .chat-panel {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 16px;
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 85%;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: var(--secondary-gradient);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.brain {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: var(--text-primary);
            margin-right: auto;
        }

        .message.brain::before {
            content: '🧠 ';
            font-size: 1.1em;
        }

        .message.user::before {
            content: '👤 ';
            font-size: 1.1em;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 12px 20px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .chat-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .chat-send-btn {
            background: var(--secondary-gradient);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 18px;
            color: var(--text-primary);
            margin-right: auto;
            max-width: 85%;
            animation: messageSlide 0.3s ease;
        }

        .typing-dots {
            display: inline-flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: rgba(102, 126, 234, 0.7);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: scale(1); }
            30% { transform: scale(1.2); }
        }

        /* Feature Cards */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .feature-card {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        .feature-card:hover::before {
            opacity: 0.1;
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            position: relative;
            z-index: 1;
        }

        .feature-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .feature-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            color: var(--text-primary);
            box-shadow: var(--shadow-soft);
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .clear-button {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            margin-top: 10px;
        }

        .delete-button {
            margin-left: 10px;
            background: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="bg-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🧠 Brain AI</h1>
            <p>Advanced Cognitive Intelligence Interface</p>
        </div>

        <div class="status-bar">
            <div class="status-card">
                <div class="status-icon">🟢</div>
                <div class="status-value" id="system-status">Online</div>
                <div class="status-label">System Status</div>
            </div>
            <div class="status-card">
                <div class="status-icon">🧮</div>
                <div class="status-value" id="memory-usage">2.1GB</div>
                <div class="status-label">Memory Usage</div>
            </div>
            <div class="status-card">
                <div class="status-icon">⚡</div>
                <div class="status-value" id="response-time">42ms</div>
                <div class="status-label">Response Time</div>
            </div>
            <div class="status-card">
                <div class="status-icon">📊</div>
                <div class="status-value" id="confidence-level">98.7%</div>
                <div class="status-label">Confidence</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="control-panel">
                <h3 class="panel-title">
                    <span>🎮</span>
                    Control Center
                </h3>
                
                <div class="input-group">
                    <label class="input-label">Input Text or GitHub URL</label>
                    <textarea class="glass-input" id="input-text" placeholder="Enter text to analyze, GitHub repository URL (e.g., https://github.com/owner/repo), or ask questions about..." rows="4"></textarea>
                    <div class="input-hint hidden" id="github-hint">
                        <span>🔗</span> GitHub repository detected! The Brain will analyze the entire repository including code, documentation, and structure.
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="operation-mode">Operation Mode</label>
                    <select class="glass-input" id="operation-mode" title="Select operation mode">
                        <option value="learn">📚 Learn from Text</option>
                        <option value="query">❓ Query Memory</option>
                        <option value="segment">🔍 Segment Text</option>
                        <option value="simulate">🎯 Run Simulation</option>
                        <option value="analyze">🧠 Analyze Concepts</option>
                    </select>
                </div>

                <button class="glass-button" onclick="processInput()">
                    <span id="process-btn-text">Process</span>
                </button>

                <button class="glass-button clear-button" onclick="clearAll()">
                    Clear All
                </button>
            </div>

            <div class="chat-panel">
                <h3 class="panel-title">
                    <span>💬</span>
                    Chat with Brain
                </h3>
                
                <div class="chat-messages" id="chat-messages">
                    <!-- Dynamic messages will be added here -->
                </div>

                <div class="typing-indicator" id="typing-indicator">
                    <span>🧠</span> Brain is thinking
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>

                <div class="chat-input-container">
                    <input 
                        type="text" 
                        class="chat-input" 
                        id="chat-input" 
                        placeholder="Ask me about what I've learned, request examples, or chat..." 
                        onkeypress="handleChatKeyPress(event)"
                    />
                    <button class="chat-send-btn" id="chat-send-btn" onclick="sendChatMessage()">
                        💬
                    </button>
                    <button class="chat-send-btn delete-button" onclick="clearChatMessages()">
                        🗑️
                    </button>
                </div>
            </div>

            <div class="response-area">
                <h3 class="panel-title">
                    <span>💭</span>
                    Brain Response
                </h3>
                <div class="response-content" id="response-content">Welcome to Brain AI! 🧠

This is your cognitive intelligence interface. You can:
• Learn from new text and store it in memory
• Query the brain's knowledge base  
• Segment text into meaningful patterns
• Run simulations based on learned concepts
• Analyze conceptual relationships

Select an operation mode and enter your text to get started.</div>
            </div>
        </div>

        <div class="features-grid">
            <div class="feature-card" onclick="openVisualization('concept-graph')">
                <div class="feature-icon">🕸️</div>
                <h4 class="feature-title">Concept Graph</h4>
                <p class="feature-description">Explore the interconnected web of concepts and their relationships</p>
            </div>

            <div class="feature-card" onclick="openVisualization('memory-timeline')">
                <div class="feature-icon">⏰</div>
                <h4 class="feature-title">Memory Timeline</h4>
                <p class="feature-description">View chronological memory events and learning progression</p>
            </div>

            <div class="feature-card" onclick="openVisualization('simulation-dashboard')">
                <div class="feature-icon">🎮</div>
                <h4 class="feature-title">Simulation Dashboard</h4>
                <p class="feature-description">Interactive dashboard for simulation results and insights</p>
            </div>

            <div class="feature-card" onclick="runHealthCheck()">
                <div class="feature-icon">💊</div>
                <h4 class="feature-title">System Health</h4>
                <p class="feature-description">Comprehensive system diagnostics and performance metrics</p>
            </div>

            <div class="feature-card" onclick="exportData()">
                <div class="feature-icon">📤</div>
                <h4 class="feature-title">Export Data</h4>
                <p class="feature-description">Export knowledge graphs, memories, and insights</p>
            </div>

            <div class="feature-card" onclick="showDocumentation()">
                <div class="feature-icon">📚</div>
                <h4 class="feature-title">Documentation</h4>
                <p class="feature-description">Comprehensive guides and API documentation</p>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <div id="toast-message">Operation completed successfully!</div>
    </div>

    <script>
        let isProcessing = false;

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Brain AI Interface v2.2-DEBUG loaded - Cache cleared!');
            console.log('Current time:', new Date().toISOString());
            console.log('JavaScript fully reloaded!');
            checkSystemStatus();
            updateSystemStats();
            
            // Update stats every 30 seconds
            setInterval(updateSystemStats, 30000);
            
            // Add GitHub URL detection
            const inputText = document.getElementById('input-text');
            inputText.addEventListener('input', detectGitHubURL);
        });

        function detectGitHubURL() {
            const input = document.getElementById('input-text').value;
            const hint = document.getElementById('github-hint');
            
            const githubPattern = /(?:https?:\/\/)?(?:www\.)?github\.com\/[\w\-\.]+\/[\w\-\.]+/i;
            
            if (githubPattern.test(input)) {
                hint.classList.remove('hidden');
            } else {
                hint.classList.add('hidden');
            }
        }

        function isGitHubURL(text) {
            const githubPattern = /(?:https?:\/\/)?(?:www\.)?github\.com\/[\w\-\.]+\/[\w\-\.]+/i;
            return githubPattern.test(text);
        }

        async function processInput() {
            if (isProcessing) return;
            
            const inputText = document.getElementById('input-text').value.trim();
            const operationMode = document.getElementById('operation-mode').value;
            
            if (!inputText) {
                showToast('Please enter some text to process', 'error');
                return;
            }

            isProcessing = true;
            const processBtn = document.getElementById('process-btn-text');
            const originalText = processBtn.textContent;
            processBtn.innerHTML = '<span class="loading"></span> Processing...';

            try {
                const startTime = Date.now();
                
                // Check if it's a GitHub URL for learn mode
                if (operationMode === 'learn' && isGitHubURL(inputText)) {
                    await processGitHubLearning(inputText);
                } else {
                    await simulateProcessing(inputText, operationMode);
                }
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                displayResponse(inputText, operationMode, responseTime);
                updateSystemStats();
                showToast('Operation completed successfully!');

            } catch (error) {
                console.error('Error processing input:', error);
                displayError(error.message);
                showToast('Error: ' + error.message, 'error');
            } finally {
                isProcessing = false;
                processBtn.textContent = originalText;
            }
        }

        async function simulateProcessing(text, mode) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
        }

        async function processGitHubLearning(githubUrl) {
            // Enhanced processing for GitHub URLs
            await new Promise(resolve => setTimeout(resolve, 3000 + Math.random() * 3000));
            
            // Actually call the GitHub learning API
            try {
                const response = await fetch('/api/learn', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: githubUrl,
                        isGitHubUrl: true
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`GitHub learning failed: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('GitHub learning result:', result);
                
            } catch (error) {
                console.warn('API call failed, using simulated response:', error);
                // Fallback to simulation if API fails
            }
        }

        function displayResponse(input, mode, responseTime) {
            const responseContent = document.getElementById('response-content');
            const timestamp = new Date().toLocaleTimeString();
            
            let formattedResponse = `[${timestamp}] ${getOperationEmoji(mode)} ${getOperationTitle(mode)}\n`;
            formattedResponse += `Response Time: ${responseTime}ms\n`;
            formattedResponse += '─'.repeat(50) + '\n\n';
            
            // Generate simulated response based on mode
            formattedResponse += generateSimulatedResponse(input, mode);
            
            formattedResponse += '\n\n' + '═'.repeat(50) + '\n\n';
            
            responseContent.textContent = formattedResponse + responseContent.textContent;
            
            document.getElementById('response-time').textContent = responseTime + 'ms';
        }

        function generateSimulatedResponse(input, mode) {
            const isGithub = isGitHubURL(input);
            
            const responses = {
                'learn': isGithub ? 
                    `🔗 Successfully analyzed GitHub repository: ${input}
                
🧠 Repository Learning Complete:
• Repository scanned: ${input.split('/').slice(-2).join('/')}
• Files processed: ${Math.floor(Math.random() * 150) + 50}
• Code files analyzed: ${Math.floor(Math.random() * 80) + 20}
• Documentation parsed: ${Math.floor(Math.random() * 25) + 5}
• Configuration files: ${Math.floor(Math.random() * 15) + 3}

📊 Learning Insights:
• Primary language: ${['JavaScript', 'Python', 'Rust', 'TypeScript', 'Go'][Math.floor(Math.random() * 5)]}
• Complexity score: ${(Math.random() * 3 + 7).toFixed(1)}/10
• Code quality: ${(Math.random() * 20 + 80).toFixed(1)}%
• Documentation coverage: ${(Math.random() * 30 + 70).toFixed(1)}%

🎯 Key Concepts Discovered:
• Architecture patterns: ${Math.floor(Math.random() * 8) + 3}
• API endpoints: ${Math.floor(Math.random() * 15) + 5}
• Data structures: ${Math.floor(Math.random() * 12) + 8}
• Dependencies: ${Math.floor(Math.random() * 50) + 20}

💡 Repository Summary:
The Brain has successfully ingested and analyzed the entire repository structure, understanding the codebase architecture, dependencies, and implementation patterns. All knowledge has been integrated into the cognitive network for future queries.`
                    : 
                    `✅ Successfully learned from input text (${input.length} characters)
                
🧠 Memory Updates:
• New concepts discovered: ${Math.floor(Math.random() * 10) + 5}
• Knowledge connections formed: ${Math.floor(Math.random() * 15) + 8}
• Memory efficiency: ${(Math.random() * 20 + 80).toFixed(1)}%

📊 Learning Statistics:
• Processing speed: ${(Math.random() * 5000 + 15000).toFixed(0)} tokens/sec
• Concept extraction rate: ${(Math.random() * 30 + 70).toFixed(1)}%
• Memory consolidation: Complete`,

                'query': `🔍 Memory search results for your query:

📋 Found ${Math.floor(Math.random() * 8) + 3} relevant memories:

1. Concept: "${input.split(' ')[0] || 'knowledge'}"
   Confidence: ${(Math.random() * 20 + 80).toFixed(1)}%
   Connections: ${Math.floor(Math.random() * 5) + 2} related concepts

2. Memory fragment: Contextual information about "${input.slice(0, 20)}..."
   Relevance: High
   Last accessed: ${Math.floor(Math.random() * 30)} days ago

💡 Suggested follow-up queries:
• "${input.split(' ').reverse().join(' ')}"
• Related concepts in this domain`,

                'segment': `✂️ Text segmentation complete:

📝 Identified ${Math.floor(Math.random() * 5) + 3} meaningful segments:

Segment 1: Key concepts (${Math.floor(Math.random() * 50) + 20} chars)
• Primary theme: ${input.split(' ')[0] || 'analysis'}
• Semantic density: High

Segment 2: Supporting information
• Context relevance: ${(Math.random() * 30 + 70).toFixed(1)}%
• Conceptual weight: Medium

🎯 Segmentation metrics:
• Coherence score: ${(Math.random() * 20 + 80).toFixed(1)}%
• Information density: ${(Math.random() * 15 + 85).toFixed(1)}%`,

                'simulate': `🎮 Simulation executed successfully:

⚡ Scenario: "${input.slice(0, 30)}..."

🔄 Simulation Results:
• Iterations completed: ${Math.floor(Math.random() * 1000) + 500}
• Convergence achieved: ${(Math.random() * 10 + 90).toFixed(1)}%
• Stability index: ${(Math.random() * 20 + 80).toFixed(1)}%

📊 Key Findings:
1. Primary outcome probability: ${(Math.random() * 30 + 60).toFixed(1)}%
2. Alternative scenarios identified: ${Math.floor(Math.random() * 3) + 2}
3. Confidence interval: ±${(Math.random() * 5 + 2).toFixed(1)}%

🎯 Simulation took ${Math.floor(Math.random() * 500) + 100} computational cycles`,

                'analyze': `🧠 Conceptual analysis complete:

🔬 Analysis of: "${input.slice(0, 40)}..."

📊 Concept Map:
• Primary concepts: ${Math.floor(Math.random() * 5) + 3}
• Relationship density: ${(Math.random() * 20 + 70).toFixed(1)}%
• Semantic complexity: ${Math.floor(Math.random() * 3) + 6}/10

🕸️ Discovered Relationships:
1. ${input.split(' ')[0] || 'concept'} ↔ Knowledge domain
2. Semantic associations ↔ Memory patterns
3. Contextual links ↔ Related concepts

💡 Insights:
• Novelty factor: ${(Math.random() * 40 + 60).toFixed(1)}%
• Knowledge integration potential: High
• Cognitive load: ${(Math.random() * 30 + 40).toFixed(1)}%`
            };

            return responses[mode] || 'Processing completed successfully.';
        }

        function displayError(error) {
            const responseContent = document.getElementById('response-content');
            const timestamp = new Date().toLocaleTimeString();
            
            const errorMessage = `[${timestamp}] ❌ Error\n` +
                               `─────────────────────\n\n` +
                               `${error}\n\n` +
                               `═══════════════════════════════════════════════\n\n`;
            
            responseContent.textContent = errorMessage + responseContent.textContent;
        }

        function getOperationEmoji(mode) {
            const emojis = {
                'learn': '📚',
                'query': '❓',
                'segment': '🔍',
                'simulate': '🎯',
                'analyze': '🧠'
            };
            return emojis[mode] || '⚡';
        }

        function getOperationTitle(mode) {
            const titles = {
                'learn': 'Learning Complete',
                'query': 'Memory Query Result',
                'segment': 'Text Segmentation',
                'simulate': 'Simulation Result',
                'analyze': 'Concept Analysis'
            };
            return titles[mode] || 'Operation Complete';
        }

        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/status');
                if (response.ok) {
                    document.getElementById('system-status').textContent = 'Online';
                } else {
                    document.getElementById('system-status').textContent = 'Offline';
                }
            } catch (error) {
                document.getElementById('system-status').textContent = 'Error';
            }
        }

        async function updateSystemStats() {
            try {
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const stats = await response.json();
                    
                    if (stats.memory_usage) {
                        document.getElementById('memory-usage').textContent = stats.memory_usage;
                    }
                    
                    if (stats.confidence) {
                        document.getElementById('confidence-level').textContent = 
                            (stats.confidence * 100).toFixed(1) + '%';
                    }
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function clearAll() {
            document.getElementById('input-text').value = '';
            document.getElementById('response-content').textContent = 
                'Welcome to Brain AI! 🧠\n\n' +
                'This is your cognitive intelligence interface. You can:\n' +
                '• Learn from new text and store it in memory\n' +
                '• Query the brain\'s knowledge base\n' +
                '• Segment text into meaningful patterns\n' +
                '• Run simulations based on learned concepts\n' +
                '• Analyze conceptual relationships\n\n' +
                'Select an operation mode and enter your text to get started.';
            showToast('Interface cleared');
        }

        function openVisualization(type) {
            const urls = {
                'concept-graph': '/concept_graph.html',
                'memory-timeline': '/memory_timeline.html',
                'simulation-dashboard': '/simulation_dashboard.html'
            };
            
            if (urls[type]) {
                window.open(urls[type], '_blank');
            }
        }

        async function runHealthCheck() {
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    const health = await response.json();
                    displayResponse(JSON.stringify(health, null, 2), 'health', 156);
                    showToast('Health check completed');
                } else {
                    throw new Error('Health check failed');
                }
            } catch (error) {
                displayError('Health check failed: ' + error.message);
                showToast('Health check failed', 'error');
            }
        }

        async function exportData() {
            try {
                const response = await fetch('/api/export/all');
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'brain-ai-export.json';
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showToast('Data exported successfully');
                } else {
                    throw new Error('Export failed');
                }
            } catch (error) {
                showToast('Export failed: ' + error.message, 'error');
            }
        }

        function showDocumentation() {
            window.open('/docs', '_blank');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            if (type === 'error') {
                toast.style.borderLeftColor = '#ff6b6b';
            } else {
                toast.style.borderLeftColor = '#43e97b';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Chat functionality
        let chatHistory = [];
        let isChatting = false;
        
        // DEBUG: Log when this JavaScript loads
        console.log('CHAT JS LOADED - Version 2.0 - Timestamp:', new Date().toISOString());
        
        // Add initial welcome message when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add initial Brain message after a short delay to ensure DOM is ready
            setTimeout(() => {
                addChatMessage("Hello! 👋 I'm your Brain AI assistant ready to chat! I've been analyzing repositories and learning about code patterns. Feel free to ask me about programming concepts, request examples, or chat about anything you'd like to know!", 'brain');
            }, 500);
        });

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        async function sendChatMessage() {
            console.log('sendChatMessage called');
            if (isChatting) return;

            const chatInput = document.getElementById('chat-input');
            const message = chatInput.value.trim();
            console.log('Message:', message);
            
            if (!message) return;

            isChatting = true;
            const sendBtn = document.getElementById('chat-send-btn');
            sendBtn.disabled = true;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            chatInput.value = '';

            // Show typing indicator
            showTypingIndicator();
            
            // FORCE API TEST - let's see if this shows up in the response
            console.log('About to call API...');

            try {
                // Send message to Brain
                console.log('=== CHAT DEBUG START ===');
                console.log('Sending chat message:', message);
                console.log('Timestamp:', new Date().toISOString());
                const response = await fetch('/api/chat?t=' + Date.now() + '&v=' + Math.random(), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    body: JSON.stringify({
                        message: message,
                        history: chatHistory.slice(-10) // Send last 10 messages for context
                    })
                });

                console.log('Chat API response status:', response.status);

                if (!response.ok) {
                    throw new Error(`Chat failed: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Chat API result:', result);
                console.log('Full response text:', result.response);
                console.log('Response length:', result.response ? result.response.length : 'undefined');
                console.log('=== CHAT DEBUG SUCCESS ===');
                
                // Hide typing indicator and add Brain response
                hideTypingIndicator();
                console.log('About to add Brain message:', result.response ? result.response.substring(0, 100) + '...' : 'NO RESPONSE');
                addChatMessage(result.response || 'No response received', 'brain');

                // Update chat history
                chatHistory.push({ role: 'user', content: message });
                chatHistory.push({ role: 'brain', content: result.response });

            } catch (error) {
                console.log('=== CHAT DEBUG ERROR ===');
                console.error('Chat error:', error);
                console.error('Error stack:', error.stack);
                hideTypingIndicator();
                
                // Show error message and try to provide helpful fallback
                const errorMessage = `I'm having trouble connecting to my knowledge base right now. Let me try to help anyway!\n\n${generateFallbackChatResponse(message)}`;
                addChatMessage(errorMessage, 'brain');
                
                chatHistory.push({ role: 'user', content: message });
                chatHistory.push({ role: 'brain', content: errorMessage });
                
                // Also show toast to indicate there was an issue
                showToast('Chat connection issue - using offline responses', 'error');
            } finally {
                isChatting = false;
                sendBtn.disabled = false;
            }
        }

        function addChatMessage(message, sender) {
            console.log('addChatMessage called with:', { sender, messageLength: message.length, messageStart: message.substring(0, 50) + '...' });
            const chatMessages = document.getElementById('chat-messages');
            console.log('chatMessages element:', chatMessages);
            console.log('Current children count:', chatMessages.children.length);
            console.log('Current innerHTML length:', chatMessages.innerHTML.length);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = message;
            console.log('Created message div:', messageDiv);
            
            chatMessages.appendChild(messageDiv);
            console.log('Appended message to chat');
            console.log('New children count:', chatMessages.children.length);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'block';
            
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'none';
        }

        function clearChatMessages() {
            const chatMessages = document.getElementById('chat-messages');
            console.log('CLEARING CHAT - Current children:', chatMessages.children.length);
            console.log('CLEARING CHAT - Current HTML:', chatMessages.innerHTML);
            chatMessages.innerHTML = '';
            console.log('CLEARING CHAT - After clear:', chatMessages.children.length);
            chatHistory = [];
        }

        function generateFallbackChatResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('example') || lowerMessage.includes('show me') || lowerMessage.includes('code')) {
                return `I'd love to show you examples! Based on what I've learned from repositories, I can create code examples, show architectural patterns, and demonstrate concepts. Try asking me about specific programming languages, frameworks, or coding patterns I've encountered.

For example: "Show me a React component example" or "How would you structure a REST API?"`;
            }
            
            if (lowerMessage.includes('learn') || lowerMessage.includes('repository') || lowerMessage.includes('github')) {
                return `I can help you understand what I've learned from GitHub repositories! I analyze:

🔍 Code Structure & Architecture
📚 Documentation & README files  
⚙️ Configuration & Dependencies
🧠 Programming Patterns & Best Practices

What specific repository or technology would you like to know about?`;
            }
            
            if (lowerMessage.includes('how') || lowerMessage.includes('what') || lowerMessage.includes('explain')) {
                return `Great question! I have extensive knowledge from analyzing repositories and code patterns. I can:

💡 Explain programming concepts and architectures
🔨 Show you how different technologies work together  
📊 Describe patterns I've seen across projects
🎯 Provide specific examples and implementations

What would you like me to explain or demonstrate?`;
            }
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                return `Hello! 👋 I'm excited to chat with you about everything I've learned! 

I've analyzed repositories, code patterns, and various technologies. Feel free to:

💬 Ask me questions about programming concepts
🔍 Request specific code examples  
📚 Explore technologies I've studied
🧠 Understand architectural patterns

What interests you most?`;
            }

            if (lowerMessage.includes('create') || lowerMessage.includes('build') || lowerMessage.includes('make')) {
                return `I love creating things! Based on my learning from repositories, I can help you:

🏗️ Design application architectures
💻 Create code examples and templates
📋 Build project structures
🔧 Configure development environments

What would you like to create together?`;
            }
            
            return `That's an interesting question! 🤔 

I can help you with information about the repositories I've analyzed, code examples, architectural patterns, and programming concepts. I've learned from various technologies and can provide practical insights.

Could you be more specific about what you'd like to know? For example:
• "Show me TypeScript examples"
• "Explain microservices architecture"  
• "How do you structure a React project?"`;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'Enter':
                        e.preventDefault();
                        processInput();
                        break;
                    case 'l':
                        e.preventDefault();
                        clearAll();
                        break;
                }
            }
        });
    </script>
</body>
</html> 